<% layout('../layouts/purchase/layout') -%>
<% block('script', '<script src="/js/purchase/confirm.js"></script>') -%>
<div class="purchase-confirm">
    <h1 class="page-ttl"><%- __('purchase.confirm.page_ttl') %></h1>
    <p class="read"><%- __('purchase.confirm.read') %></p>

    <form method="post">
        <h2 class="section-ttl"><%- __('common.film') %></h2>
        <ul class="box bg-light-gray mb-medium">
            <li>
                <dl>
                    <dt><%- __('common.theater') %> / <%- __('common.screen') %></dt>
                    <dd><%= performance.theater.name[__('lang')] %> / <%= performance.screen.name[__('lang')] %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.film_title') %></dt>
                    <dd><%= performance.film.name[__('lang')] %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.appreciation_date') %></dt>
                    <dd><%= moment(performance.day).format('YYYY年MM月DD日') %> <%= moment(performance.time_start, 'hmm').format('HH:mm') %> - <%= moment(performance.time_end, 'hmm').format('HH:mm') %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.seat') %></dt>
                    <dd>
                        <% 
                        let seats = [];
                        for (let seat of updateReserve.list_qr) { 
                            seats.push(seat.seat_num);
                        } 
                        %>
                        <p><%= seats.join('、') %></p> 
                    </dd>
                    <dd class="column-02">
                        <div class="clearfix">
                            <div class="ghost-button blue-button">
                                <a href="#"><%- __('common.seat') %><%- __('common.confirm') %></a>
                            </div>
                            <div class="ghost-button black-button">
                                <a href="#"><%- __('common.seat') %><%- __('common.change') %></a>
                            </div>
                        </div>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.ticket') %></dt>
                    <dd>
                        <%
                        let tikcetObj = {};
                        for (let seat of updateReserve.list_qr) {
                            let code = reserveTickets[seat.seat_num].ticket_code;
                            if (tikcetObj[code]) {
                                tikcetObj[code].length++;
                            } else {
                                tikcetObj[code] = {
                                    length: 1,
                                    name: reserveTickets[seat.seat_num].ticket_name
                                };
                            }
                        }
                        let tikcets = [];
                        for (let key in tikcetObj) { 
                            tikcets.push(tikcetObj[key].name + '×' + tikcetObj[key].length + '枚');
                        }
                        %>
                        <p><%= tikcets.join('、') %></p>
                    </dd>
                    <dd>
                        <div class="ghost-button black-button">
                            <a href="#"><%- __('common.ticket') %><%- __('common.change') %></a>
                        </div>
                    </dd>
                </dl>
            </li>
            
        </ul>       
        
        <h2 class="section-ttl"><%- __('common.reservation') %></h2>
        <ul class="box bg-light-gray mb-small">
            <li>
                <dl>
                    <dt><%- __('common.name_hira') %></dt>
                    <dd><%= info.last_name_hira %> <%= info.first_name_hira %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.mail') %></dt>
                    <dd><%= info.mail_addr %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.tel') %></dt>
                    <dd><%= info.tel_num %></dd>
                </dl>
            </li>
        </ul>
        <div class="ghost-button black-button mb-medium">
            <a href="#"><%- __('common.reservation') %><%- __('common.change') %></a>
        </div>
        
        <h2 class="section-ttl"><%- __('common.payment') %></h2>
        <ul class="box bg-light-gray mb-small">
            <li>
                <dl>
                    <dt><%- __('common.cardno') %></dt>
                    <dd><%= gmoTokenObject.maskedCardNo %></dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><%- __('common.amount_spent') %></dt>
                    <dd>￥5,100</dd>
                </dl>
            </li>
        </ul>
        <div class="ghost-button black-button mb-medium">
            <a href="#"><%- __('common.reservation') %><%- __('common.change') %></a>
        </div>

        <input type="hidden" name="token" value="<%= gmoTokenObject.token %>">
        <input type="hidden" name="toBeExpiredAt" value="<%= gmoTokenObject.toBeExpiredAt %>">
        <input type="hidden" name="isSecurityCodeSet" value="<%= gmoTokenObject.isSecurityCodeSet %>">
        
        

        <div class="button-area clearfix">
            <div class="button next-button blue-button"><button type="submit"><%- __('purchase.confirm.next') %></button></div>
            <div class="prev-link"><a href="<%- url('purchase.input') %>"><%- __('purchase.confirm.prev') %></a></div>
        </div>
        
    </form>
</div>

<%- partial('complete') %>