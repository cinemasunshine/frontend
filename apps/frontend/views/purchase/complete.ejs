<% if (step === 4) { %>
<% layout('../layouts/purchase/layout') -%>
<% } %>
<% block('script', '<script src="/js/purchase/complete.js"></script>') -%>
<div class="purchase-complete">
    <h1 class="page-ttl"><%- __('purchase.complete.page_ttl') %></h1>
    <p class="read"><%- __('purchase.complete.read') %></p>

    <ul class="box bg-light-gray info mb-large form-layout">
        <li class="purchase-number">
            <dl>
                <dt><%- __('common.purchase_number') %></dt>
                <dd>
                    <strong class="red-text large-x-text"><%= (updateReserve) ? updateReserve.reserve_num : '' %></strong>
                    <p class="small-text">※チケットの発行等に必要な番号となりますので必ず忘れないようにしてください。</p>
                </dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.theater') %> / <%- __('common.screen') %></dt>
                <dd><%= performance.attributes.theater.name[__('lang')] %> / <%= performance.attributes.screen.name[__('lang')] %></dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.film_title') %></dt>
                <dd><%= performance.attributes.film.name[__('lang')] %></dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.appreciation_date') %></dt>
                <dd><%= moment(performance.attributes.day).format('YYYY年MM月DD日') %>(<%= __('week[' + moment(performance.attributes.day).format('ddd') + ']') %>) <%= moment(performance.attributes.time_start, 'hmm').format('HH:mm') %> - <%= moment(performance.attributes.time_end, 'hmm').format('HH:mm') %></dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.seat') %></dt>
                <dd>
                    <% 
                    let seats = [];
                    for (let seat of reserveSeats.list_tmp_reserve) { 
                        seats.push(seat.seat_num);
                    } 
                    %>
                    <div><%= seats.join('、') %></div> 
                </dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.ticket') %></dt>
                <dd>
                    <%
                    let ticketObj = {};
                    let tickets = [];
                    for (let ticket of reserveTickets) {
                        if (ticketObj[ticket.ticket_code]) {
                            ticketObj[ticket.ticket_code].length++;
                        }　else {
                            ticketObj[ticket.ticket_code] = {
                                name: ticket.ticket_name_ja,
                                length: 1
                            }
                        }
                    }
                    for (let key in ticketObj) {
                        let ticket = ticketObj[key];
                        tickets.push(`${ticket.name} × ${ticket.length}`);
                    }
                    %>
                    <div><%= tickets.join('、') %></div>
                </dd>
            </dl>
        </li>
        <li>
            <dl>
                <dt><%- __('common.amount_spent') %></dt>
                <dd>￥<%= price %></dd>
            </dl>
        </li>
    </ul>

    <h2 class="page-ttl"><%- __('purchase.complete.entry') %></h2>
    <p class="read"><%- __('purchase.complete.entry_read') %></p>

    <ul class="entry-method heighfix-group">
        <li>
            <dl class="box bg-light-gray">
                <dt class="mb-medium">
                    <span class="text-icon-dark-blue small-text"><%- __('purchase.complete.entry') %>1</span>
                    <strong><%- __('purchase.complete.entry_01_title') %></strong>
                </dt>
                <dd>
                    <p class="mb-small heighfix"><%- __('purchase.complete.entry_01_read') %></p>
                    <div class="image mb-x-small"><img src="/images/common/test.svg" alt=""></div>
                    <div class="button blue-button">
                        <a class="icon-next" href="<%- url('method.ticketing') %>" target="_blank"><%- __('purchase.complete.entry_01_button') %></a>
                    </div>
                </dd>
            </dl>
        </li>
        <li>
            <dl class="box bg-light-gray">
                <dt class="mb-medium">
                    <span class="text-icon-dark-blue small-text"><%- __('purchase.complete.entry') %>2</span>
                    <strong><%- __('purchase.complete.entry_02_title') %></strong>
                </dt>
                <dd>
                    <p class="mb-small heighfix"><%- __('purchase.complete.entry_02_read') %></p>
                    <div class="image mb-x-small"><img src="/images/common/test.svg" alt=""></div>
                    <div class="button blue-button inquiry-button">
                        <a class="icon-next" href="<%- url('inquiry') %>" target="_blank"><%- __('purchase.complete.entry_02_button') %></a>
                    </div>
                    <form class="inquiry-form" method="post" method="post" target="_blank" action="<%- url('inquiry.login') %>">
                        <input type="hidden" name="theater_code" value="<%= performance.attributes.theater._id %>">
                        <input type="hidden" name="reserve_num" value="<% (updateReserve) ? updateReserve.reserve_num : '' %>">
                        <input type="hidden" name="tel_num" value="<%= input.tel_num %>">
                    </form>
                </dd>
            </dl>
        </li>
    </ul>

    <div class="button-area clearfix">
        <div class="prev-link"><a class="icon-prev"href="<%- url('index') %>"><%- __('purchase.complete.prev') %></a></div>
    </div>

</div>