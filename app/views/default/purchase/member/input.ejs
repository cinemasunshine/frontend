<%- contentFor('script') %>
<script src="/js/purchase/member/input.js"></script>
<script src="<%= GMO_ENDPOINT %>/ext/js/token.js"></script>
<script>Multipayment.init('<%= purchaseModel.movieTheaterOrganization.gmoInfo.shopId %>');</script>
<%- contentFor('body') %>
<div class="purchase-input">
    <h1 class="page-ttl"><%- __('purchase.input.page_ttl') %></h1>
    <p class="read"><%- __('purchase.input.read') %></p>

    <form id="purchaseform" method="post" action="/purchase/input/member">
        <input type="hidden" name="familyName" value="<%= purchaseModel.profile.familyName %>">
        <input type="hidden" name="givenName" value="<%= purchaseModel.profile.givenName %>">
        <input type="hidden" name="email" value="<%= purchaseModel.profile.email %>">
        <input type="hidden" name="emailConfirm" value="<%= purchaseModel.profile.emailConfirm %>">
        <input type="hidden" name="telephone" value="<%= purchaseModel.profile.telephone %>">

        <ul class="box radius bg-light-gray mb-middle credit form-layout">
            <li class="price">
                <dl>
                    <dt><%- __('common.amount_spent') %></dt>
                    <dd class="large-text red-text"><strong>ï¿¥<%= formatPrice(purchaseModel.getReserveAmount()) %></strong></dd>
                </dl>
            </li>
            <% if (purchaseModel.creditCards.length > 0) { %>
            <li>
                <dl>
                    <dt><%- __('common.cardno') %></dt>
                    <dd>
                        <%= purchaseModel.creditCards[0].cardNo %>
                    </dd>
                </dl>
            </li>
            <% } %>
        </ul>

        <% if (purchaseModel.creditCards.length === 0) { %>
            <div class="payment active">
        <% } else { %>
            <div class="mb-middle button change-button gray-button active"><a href="#"><%- __('common.credit_card_change') %></a></div>
            <div class="mb-middle button remove-button gray-button"><a href="#"><%- __('common.credit_card_not_change') %></a></div>

            <div class="payment">
        <% } %>
            <h2 class="section-ttl">
                <%- __('common.payment') %><span class="text-icon-red small-x-text"><%- __('common.required') %></span>
                <span class="image credit-image"><img src="/images/default/common/credit_card.png" alt=""></span>
            </h2>
            
            <p class="mb-small"><%- __('common.note.credit') %></p>
            <ul class="box radius bg-light-gray mb-large credit form-layout">
                <li>
                    <dl>
                        <dt><%- __('common.cardno') %></dt>
                        <dd>
                            <input type="text" pattern="\d*" name="cardno" id="cardNumber" autocomplete="off" value="" maxlength="16" placeholder="<%- __('common.placeholder.cardno') %>">
                            <% if (error && error.cardno) { %>
                            <div class="validation-text"><%= error.cardno.msg %></div>
                            <% } %>
                            <p class="small-x-text"><%- __('common.note.cardno') %></p>
                        </dd>
                    </dl>
                </li>
                <li>
                    <dl>
                        <dt><%- __('common.expire') %></dt>
                        <dd>
                            
                            <select name="creditMonth" id="cardExpirationMonth">
                                <%
                                for (let i = 0; i < 12; i++) {
                                    let num = i + 1;
                                    let month = (num < 10) ? '0' + String(num) : String(num);
                                %>
                                    <option value="<%= month %>"><%= month %></option>
                                <% } %>
                            </select> <%- __('common.month') %> 
                            <select name="creditYear" id="cardExpirationYear">
                                <%
                                let choices = {};
                                let year2digits = moment().format('YY');
                                for (let i = 0; i < 10; i++) {
                                    let key = (parseInt(year2digits) + i).toString();
                                    choices[key] = `20${key}`;
                                }
                                %>
                                <% for (let key in choices) { %>
                                <option value="20<%- key %>"><%- choices[key] %></option>
                                <% } %>
                            </select> <%- __('common.year') %>
                            <input type="hidden" name="expire" value="">
                            <% if (error && error.expire) { %>
                            <div class="validation-text expire"><%= error.expire.msg %></div>
                            <% } %>
                        </dd>
                    </dl>
                </li>
                <li>
                    <dl>
                        <dt><%- __('common.securitycode') %></dt>
                        <dd>
                            <input type="text" pattern="\d*" name="securitycode" maxlength="4" autocomplete="off" value="" placeholder="<%- __('common.placeholder.securitycode') %>">
                            <% if (error && error.securitycode) { %>
                            <div class="validation-text"><%= error.securitycode.msg %></div>
                            <% } %>
                            <p><a href="#" data-modal="securitycode"><%- __('common.note.securitycode') %></a></p>
                        </dd>
                    </dl>
                </li>
                <li>
                    <dl>
                        <dt><%- __('common.holdername') %></dt>
                        <dd>
                            <input type="text" name="holdername" autocomplete="off" value="" placeholder="<%- __('common.placeholder.holdername') %>">
                            <% if (error && error.holdername) { %>
                            <div class="validation-text"><%= error.holdername.msg %></div>
                            <% } %>
                        </dd>
                    </dl>
                </li>
            </ul>
            <div class="text-center">
                <input type="checkbox" name="creditCardRegistration" value="true" id="creditCardRegistration">
                <label for="creditCardRegistration" class="credit-card-registration"><strong><%- __('common.credit_card_registration') %></strong></label>
            </div>  
            <input type="hidden" name="gmoTokenObject" value="">
            <input type="hidden" name="gmoError" value="<%- (error && error.gmo) ? error.gmo.msg : '' %>">
            <input type="hidden" name="gmoErrorMessage" value="<%- (gmoError !== null) ? gmoError.message : '' %>">
        </div>
        
        
        <div class="button-area clearfix">
            <div class="button next-button blue-button"><button class="icon-next-white" type="submit"><%- __('purchase.input.next') %></button></div>
            <div class="prev-link"><a class="icon-prev-black"href="/purchase/ticket/"><%- __('purchase.input.prev') %></a></div>
        </div>
        <input type="hidden" name="transactionId" value="<%= purchaseModel.transaction.id %>">
    </form>
    <input type="hidden" name="price" value="<%= purchaseModel.getReserveAmount() %>">
<%- include('../../layouts/siteSeal') %>
</div>

<%- include('../../locales/validation') %>

<%- contentFor('modals') %>
<%- include('../modals/securitycode') %>
<%- include('../modals/creditcardAlert') %>
