<%- contentFor('script') %>
<script src="/js/inquiry/index.js"></script>

<%- contentFor('body') %>
<% const screenPrefix = (NODE_ENV === 'production') ? '0' : '1'; %>
<div class="inquiry-confirm">
    <h1 class="page-ttl">チケット情報確認</h1>
    <p class="read">入場に必要なQRコードの情報は下記になります。</p>

    <div class="ghost-button black-button mb-large center-button ticket-scroll-button">
        <a class="icon-ticket-black" href="#">チケット情報まで移動</a>
    </div>

    <div class="box radius bg-ultra-light-gray mb-large">
        <div class="section-ttl text-center">スムーズに入場するには？</div>
        <p class="small-x-text mb-small read">
            このページをホーム画面やブックマーク、お気に入りに追加すると<br>当日に予約番号と電話番号を入力しなくてもQRコードが表示できて当日の入場もスムーズです。</p>
        <div class="small-x-text bookmark"><img src="/images/inquiry/bookmark.svg" alt=""></div>
    </div>

    <div class="box radius bg-light-gray mb-large">
        <dl>
            <dt>予約番号</dt>
            <dd><strong class="red-text large-x-text"><%= inquiryModel.input.reserveNum %></strong></dd>
            <dd class="small-x-text">※チケットの発行・照会等に必要な番号となりますので必ずお控えください。</dd>
        </dl>
    </div>

    <h2 class="page-ttl qr-tickets">入場用QRコード</h2>
    <p class="read">当日ご入場の際は、QRコードをスタッフに提示してご入場してください。</p>
    <ul class="tickets mb-large">
        <% for (let i = 0; i < inquiryModel.order.acceptedOffers.length; i++) { %>
        <% const offer = inquiryModel.order.acceptedOffers[i] %>
        <li class="ticket">
            <div class="inner bg-light-gray">
                <div class="box radius border-bottom-dot bg-white">
                    <div class="mb-xx-small small-text"><strong>座席</strong>
                        [券種]</div>
                    <div class="ticket-number bg-light-gray small-text">
                        <%- `${i + 1}/${inquiryModel.order.acceptedOffers.length}` %>枚
                    </div>
                    <div class="mb-xx-small">
                        <strong
                            class="large-text"><%= offer.itemOffered.reservedTicket.ticketedSeat.seatNumber %></strong>
                    </div>
                    <div>
                        [<%= offer.itemOffered.reservedTicket.coaTicketInfo.ticketName %>]
                    </div>
                </div>

                <% if (moment(offer.itemOffered.reservationFor.endDate).add(1, 'months').unix() < moment().unix()) { %>
                <div class="box radius border-bottom-dot not-qr-code bg-white">
                    <p class="text-center">上映日から1ヶ月以上経過しています。</p>
                </div>
                <% } else if (moment(offer.itemOffered.reservationFor.startDate).subtract(24, 'hours').unix() > moment().unix()) { %>
                <div class="box radius border-bottom-dot not-qr-code bg-white">
                    <p class="text-center">鑑賞日前日からQRコードが表示されます。</p>
                </div>
                <% } else { %>
                <div class="box radius border-bottom-dot qr-code bg-white text-center"
                    data-qrcode="<%- offer.itemOffered.reservedTicket.ticketToken %>"></div>
                <% } %>
                <div class="box">
                    <div class="mb-xx-small small-text"><strong>鑑賞日時</strong></div>
                    <div class="mb-x-small">
                        <%
                        moment.locale('ja');
                        const date = moment(offer.itemOffered.reservationFor.coaInfo.dateJouei).format('YYYY年MM月DD日(ddd)');
                        const startTime = timeFormat(offer.itemOffered.reservationFor.startDate, offer.itemOffered.reservationFor.coaInfo.dateJouei);
                        const endTime = timeFormat(offer.itemOffered.reservationFor.endDate, offer.itemOffered.reservationFor.coaInfo.dateJouei);
                         %>
                        <%= date %> <%= startTime %> - <%= endTime %>
                    </div>
                    <div class="mb-xx-small small-text"><strong>劇場</strong></div>
                    <div class="mb-x-small"><%= inquiryModel.seller.location.name.ja %></div>
                    <div class="mb-xx-small small-text"><strong>スクリーン</strong></div>
                    <div class="mb-x-small"><%= offer.itemOffered.reservationFor.location.name.ja %></div>
                    <div class="mb-xx-small small-text"><strong>作品名</strong></div>
                    <div class="mb-x-small"><%= offer.itemOffered.reservationFor.name.ja %></div>
                    <% if (offer.itemOffered.reservationFor.location.branchCode === (screenPrefix + '20') 
                     && offer.itemOffered.reservedTicket.coaTicketInfo.spseatKbn === '003'
                     && offer.itemOffered.reservedTicket.coaTicketInfo.spseatAdd2 > 0) { %>
                    <p>
                        【グランドクラス】<br>
                        <span class="red-text">本チケットには、ミールクーポン<%= offer.itemOffered.reservedTicket.coaTicketInfo.spseatAdd2.toLocaleString() %>円分が含まれています。</span><br>
                        4F・コンセッション、5F・クラッパーズダイナー、12F・バール パノーラマのいずれかでご提示の上、ご利用願います。<br>
                        ※お釣りのお返しは致しかねます。<br>
                        ※ご鑑賞日当日のみ有効
                    </p>
                    <% } %>
                    <% if (offer.itemOffered.reservationFor.location.branchCode === (screenPrefix + '20') 
                     && offer.itemOffered.reservedTicket.coaTicketInfo.spseatKbn === '002'
                     && offer.itemOffered.reservedTicket.coaTicketInfo.spseatAdd2 > 0) { %>
                    <p>
                        【プレミアムクラス】<br>
                        <span class="red-text">本チケットには、ミールクーポン<%= offer.itemOffered.reservedTicket.coaTicketInfo.spseatAdd2.toLocaleString() %>円分が含まれています。</span><br>
                        4F・コンセッション、5F・クラッパーズダイナー、12F・バール パノーラマのいずれかでご提示の上、ご利用願います。<br>
                        ※お釣りのお返しは致しかねます。<br>
                        ※ご鑑賞日当日のみ有効
                    </p>
                    <% } %>
                </div>
            </div>
        </li>
        <% } %>
    </ul>

    <div class="button-area clearfix">
        <div class="prev-link"><a class="icon-prev-black"
                href="/inquiry/login?theater=<%= inquiryModel.seller.location.branchCode %>"><%- __('inquiry.confirm.prev') %></a>
        </div>
    </div>
</div>
<div id="copy" style="display: none"></div>

<input type="hidden" name="theaterCode" value="<%= inquiryModel.seller.location.branchCode %>">
<input type="hidden" name="branchCode" value="<%= inquiryModel.seller.location.branchCode %>">
<input type="hidden" name="reserveNum" value="<%= inquiryModel.input.reserveNum %>">
<input type="hidden" name="telephone" value="<%= inquiryModel.input.telephone %>">
<input type="hidden" name="orderNumber" value="<%= inquiryModel.order.orderNumber %>">
<input type="hidden" name="expire"
    value="<%= moment(inquiryModel.order.acceptedOffers[0].itemOffered.reservationFor.coaInfo.dateJouei).add(10, 'day').format('x') %>">